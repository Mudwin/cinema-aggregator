{% extends 'core/base.html' %}
{% block title %}Поиск фильмов{% endblock %}
{% block content %}
<div class="row mb-4">
  <div class="col-12">
    <h1 class="mb-3"><i class="bi bi-search"></i> Поиск фильмов</h1>
    <p class="lead">
      Найдите фильм по названию и получите рейтинги из всех источников
    </p>
  </div>
</div>

<!-- Форма поиска -->
<div class="card mb-4">
  <div class="card-body">
    <form method="get" action="{% url 'film_search' %}" class="row g-3">
      <div class="col-md-8">
        <label for="query" class="form-label">Название фильма</label>
        <input
          type="text"
          class="form-control form-control-lg"
          id="query"
          name="q"
          value="{{ query|default:'' }}"
          placeholder="Введите название фильма..."
          required
        />
      </div>
      <div class="col-md-3">
        <label for="year" class="form-label">Год выпуска (опционально)</label>
        <input
          type="number"
          class="form-control form-control-lg"
          id="year"
          name="year"
          value="{{ year|default:'' }}"
          placeholder="Например: 1999"
          min="1900"
          max="{% now 'Y' %}"
        />
      </div>
      <div class="col-md-1 d-flex align-items-end">
        <button type="submit" class="btn btn-primary btn-lg w-100">
          <i class="bi bi-search"></i> Найти
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Результаты поиска -->
{% if query %}
    <div class="row mb-3">
        <div class="col-12">
            <h3>Результаты поиска для "{{ query }}"{% if year %} ({{ year }} год){% endif %}</h3>
        </div>
    </div>

    {% if films %}
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4">
            {% for film in films %}
                <div class="col">
                    <div class="card film-card">
                        {% if film.poster_url %}
                            <img src="{{ film.poster_url }}" class="card-img-top film-poster" alt="{{ film.title }}">
                        {% else %}
                            <div class="film-poster bg-secondary d-flex align-items-center justify-content-center">
                                <i class="bi bi-film" style="font-size: 3rem; color: white;"></i>
                            </div>
                        {% endif %}
                        
                        {% if film.db_rating %}
                            <div class="rating-badge">
                                {{ film.db_rating|floatformat:1 }}
                            </div>
                        {% elif film.tmdb_rating %}
                            <div class="rating-badge" style="background: rgba(13, 110, 253, 0.8);">
                                TMDB: {{ film.tmdb_rating|floatformat:1 }}
                            </div>
                        {% endif %}
                        
                        <div class="card-body">
                            <h5 class="card-title">{{ film.title }}</h5>
                            <p class="card-text text-muted">
                                {{ film.year }}
                                {% if film.original_title and film.original_title != film.title %}
                                    <br><small>({{ film.original_title }})</small>
                                {% endif %}
                            </p>
                            
                            {% if film.in_database %}
                                <a href="{% url 'film_detail' film.db_film_id %}" class="btn btn-primary w-100">
                                    <i class="bi bi-info-circle"></i> Подробнее (в базе)
                                </a>
                            {% else %}
                                <a href="{% url 'film_preview' film.tmdb_id %}" class="btn btn-outline-primary w-100">
                                    <i class="bi bi-eye"></i> Предпросмотр
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        
    {% else %}
        <div class="alert alert-warning">
            <i class="bi bi-exclamation-triangle"></i>
            Фильмы не найдены.
        </div>
    {% endif %}
{% else %}
    <!-- Инструкция при первом заходе -->
    <div class="row mt-5">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-body text-center">
                    <i class="bi bi-search-heart" style="font-size: 4rem; color: var(--primary-color);"></i>
                    <h3 class="mt-3">Как использовать поиск</h3>
                    <p class="lead">Введите название фильма в поле выше</p>
                    
                    <div class="row mt-4">
                        <div class="col-md-6 mb-3">
                            <div class="card">
                                <div class="card-body">
                                    <h5><i class="bi bi-1-circle text-primary"></i> Предпросмотр</h5>
                                    <p>Нажмите "Предпросмотр" для просмотра информации из TMDB</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="card">
                                <div class="card-body">
                                    <h5><i class="bi bi-2-circle text-primary"></i> Импорт в базу</h5>
                                    <p>На странице предпросмотра можно импортировать фильм для получения рейтингов из всех источников</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endif %}
{% endblock %}