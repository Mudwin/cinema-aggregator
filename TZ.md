# Техническое задание: CinemaAggregator

## Цель проекта

Разработка веб-сервиса для киноманов, который агрегирует оценки фильмов из четырех авторитетных источников (IMDb, Rotten Tomatoes, Metacritic, Кинопоиск) и формирует комплексные рейтинги. Сервис решает проблему необходимости ручного сравнения оценок с разных платформ, предоставляя пользователям единую точку для объективного анализа кинокартин, а также расширенные возможности поиска по фильмам, персонам и годам выпуска.

## Роли пользователей

- Гость: Может просматривать все публичные данные (рейтинги фильмов, информацию о персонах, результаты поиска).
- Администратор: Имеет доступ к админ-панели Django для управления контентом, обновления кэшированных данных через Celery задачи, мониторинга состояния системы.

## Модели данных

**Модель 1: Film**

- `title` (CharField): Название фильма на русском
- `original_title` (CharField): Оригинальное название
- `year` (IntegerField): Год выпуска
- `description` (TextField): Описание сюжета
- `poster_url` (URLField): Ссылка на постер
- `tmdb_id` (IntegerField, unique): ID в TMDB API
- `imdb_id` (CharField, unique): ID в IMDb
- `created_at` (DateTimeField, auto_now_add): Дата создания записи
- `updated_at` (DateTimeField, auto_now): Дата обновления

**Модель 2: Person**

- `name` (CharField): Имя и фамилия на русском
- `original_name` (CharField): Имя на языке оригинала
- `tmdb_id` (IntegerField, unique): ID в TMDB API
- `biography` (TextField): Биография
- `photo_url`(URLField): Ссылка на фотографию
- `birth_date`(DateField, null=True): Дата рождения
- `death_date`(DateField, null=True): Дата смерти
- `profession`(CharField, choices): Профессия (актер, режиссер, и т.д.)

**Модель 3: FilmPersonRole**

- `film` (ForeignKey -> Film): Связь с фильмом
- `person` (ForeignKey -> Person): Связь с персоной
- `role` (CharField, choices): Роль в фильме (актер, режиссер, сценарист и т.д.)
- `character_name` (CharField, blank=True): Название персонажа (для актеров)
- `order` (IntegerField): Порядок отображения (важность роли)

**Модель 4: Rating**

- `film` (ForeignKey -> Film): Связь с фильмом
- `source` (CharField, choices): Источник (imdb, rotten_tomatoes, metacritic, kinopoisk)
- `value` (DecimalField): Значение рейтинга
- `max_value` (DecimalField): Максимальное значение шкалы (10, 100, 5)
- `votes_count` (IntegerField, null=True): Количество голосов
- `last_updated` (DateTimeField): Дата последнего обновления

## Ключевой функционал

- **Поиск фильма**: Пользователь вводит название фильма в поисковую строку, система отображает список результатов с базовой информацией. При переходе на страницу фильма отображаются агрегированные рейтинги из 4 источников, средневзвешенная оценка, информация об актерах и режиссере (кликабельные ссылки на их страницы).
- **Поиск по персонам**: Пользователь ищет актера или режиссера по имени. На странице персоны отображается фильмография, отсортированная по комплексному рейтингу, и список людей, с которыми данный человек чаще всего сотрудничал, с указанием количества совместных работ.
- **Поиск по годам**: Пользователь выбирает год или диапазон лет выпуска фильмов. Система отображает топ 100-200 фильмов за выбранный период, отсортированных по среднему рейтингу из всех источников, с возможностью пагинации.

## Внешние интеграции

- **OMDb API**: Получение рейтингов IMDb, Rotten Tomatoes и Metacritic по IMDb ID фильма.
- **Kinopoisk API Unofficial**: Получение рейтинга Кинопоиска по названию или другим идентификаторам.
- **TMDB API**: Получение основной информации о фильмах и персонах, включая постеры, описания, актерский состав и режиссеров.

## Аналитика

- **Celery + Redis**: Для асинхронных задач парсинга и обновления данных из внешних API, предотвращения блокировки основного потока при медленных запросах.
- **Pandas**: Для обработки и агрегации данных при формировании топ-списков по годам и расчете статистики сотрудничества персон.

## Изменения в ходе реализации

_(Данный раздел будет заполняться по мере разработки проекта в случае внесения существенных изменений в изначальный план)_
